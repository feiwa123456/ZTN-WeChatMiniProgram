(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/map/map"],{"0315":function(t,e,i){"use strict";(function(t){i("91b7"),i("921b");n(i("66fd"));var e=n(i("4724"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},"273d":function(t,e,i){"use strict";var n=i("9f41"),c=i.n(n);c.a},4724:function(t,e,i){"use strict";i.r(e);var n=i("f715"),c=i("90fe");for(var r in c)"default"!==r&&function(t){i.d(e,t,(function(){return c[t]}))}(r);i("273d");var a,u=i("f0c5"),o=Object(u["a"])(c["default"],n["b"],n["c"],!1,null,"34c5fe3c",null,!1,n["a"],a);e["default"]=o.exports},"90fe":function(t,e,i){"use strict";i.r(e);var n=i("afe2"),c=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);e["default"]=c.a},"9f41":function(t,e,i){},afe2:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=u(i("b060")),c=a(i("9bc8"));function r(){if("function"!==typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function a(t){if(t&&t.__esModule)return t;if(null===t||"object"!==typeof t&&"function"!==typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){var a=n?Object.getOwnPropertyDescriptor(t,c):null;a&&(a.get||a.set)?Object.defineProperty(i,c,a):i[c]=t[c]}return i.default=t,e&&e.set(t,i),i}function u(t){return t&&t.__esModule?t:{default:t}}var o=function(){i.e("components/ztn-custom/surplus/surplus").then(function(){return resolve(i("617a"))}.bind(null,i)).catch(i.oe)},s=function(){i.e("components/ztn-custom/mapFav/mapFav").then(function(){return resolve(i("f53d"))}.bind(null,i)).catch(i.oe)},l={mixins:[n.default],data:function(){return{downOption:{use:!1,auto:!1},upOption:{empty:{use:!0,fixed:!0,top:"10%"}},CustomBar:this.CustomBar,isLogin:!0,isLoginOverdue:!1,scale:4.5,enlargeScale:!1,longitude:114.32452,latitude:27.099994,markers:[],markerId:Number,productId:null,status:null,currentPage:1,pageSize:10,currentStatusIndex:0,currentTypeIndex:0,productTypeList:[],productTypeData:[],deviceList:[],isShowDeviceList:!1,totalDeviceNum:0,hideIcon:"../../static/images/down.png",modalDeviceName:"",listTouchStart:0,listTouchDirection:null}},name:"mapComponent",computed:{i18n:function(){return this.$i18nMsg()}},mounted:function(){var e=t.getStorageSync("isLogin")||!1;this.isLogin=e,e&&this.init()},methods:{init:function(){this.getProductTypeList(),this.enlargeScale?this.getCityDeviceNum():this.getProvinceDeviceNum()},goToLogin:function(e){t.navigateTo({url:"/pages/login/login"})},getProductTypeList:function(){var e=this,i=t.getStorageSync("userId");c.getProductTypeList(this,i).then((function(t){if("200"==t.code){var i=t.data,n=e.$uniUtilsApi.handleProductType(e,i),c=n.productTypeList,r=n.productTypeData;e.productTypeList=c,e.productTypeData=r}}))},getProvinceDeviceNum:function(){var t=this;c.getProvinceDeviceNum(this).then((function(e){if("200"==e.code){var i=e.data;t.setMarkers(i)}}))},getCityDeviceNum:function(){var t=this;c.getCityDeviceNum(this).then((function(e){if("200"==e.code){var i=e.data;t.setMarkers(i)}}))},setMarkers:function(t){this.markers=[];for(var e=0;e<t.length;e++){var i={};i.id=Number(t[e].cityId?t[e].cityId:t[e].provinceId),i.width=25,i.height=25,i.latitude=Number(t[e].lat),i.longitude=Number(t[e].lng),t[e].num>=99?i.iconPath="../../static/numsImage/local_99.png":i.iconPath="../../static/numsImage/local_"+t[e].num+".png",this.$set(this.markers,e,i)}},markertap:function(t){this.markerId=t.detail.markerId,this.isShowDeviceList=!0,this.$emit("isShowNav",!1),this.currentPage=1},markerGetDeviceList:function(){var t=this,e=this.enlargeScale,i=e?null:this.markerId,n=e?this.markerId:null,r=this.productId,a=this.status,u=this.currentPage,o=this.pageSize;c.MarkerGetDeviceList(this,i,n,r,a,u,o).then((function(e){if("200"==e.code){var i=e.data,n=i.currentPage,c=i.data,r=i.total;t.totalDeviceNum=r,t.mescroll.endByPage(c.length,r);var a=n-1,u=t.$uniUtilsApi.initDeviceList(t.i18n.status,c);t.$set(t.deviceList,a,u),t.currentPage=n+1}}))},regionchange:function(){var e=this,i=new Promise((function(i){t.createMapContext("myMap",e).getScale({success:function(t){i(t)}})}));i.then((function(t){e.getDeviceNum(t)}))},getDeviceNum:function(t){var e=this.enlargeScale,i=t.scale;i<7&&e?(this.getProvinceDeviceNum(),this.enlargeScale=!1):i>=7&&!e&&(this.getCityDeviceNum(),this.enlargeScale=!0)},hideDeviceList:function(){this.isShowDeviceList=!1,this.$emit("isShowNav",!0),this.currentStatusIndex=0,this.currentTypeIndex=0,this.status=null,this.productId=null,this.currentPage=1,this.deviceList=[]},ListTouchStart:function(t){this.listTouchStart=t.touches[0].pageX},ListTouchMove:function(t){this.listTouchDirection=t.touches[0].pageX-this.listTouchStart>0?"right":"left"},ListTouchEnd:function(t){"left"==this.listTouchDirection?this.modalDeviceName=t.currentTarget.dataset.devicename:this.modalDeviceName=null,this.listTouchDirection=null},deviceNavigation:function(e,i,n){t.navigateTo({url:"/pages/deviceNavigation/deviceNavigation?deviceName=".concat(e,"&deviceCore=").concat(i,"&pageCur=").concat(n)})},navigation:function(e){var i=e.deviceLat,n=e.deviceLng,c=e.deviceName,r=e.deviceAddr;t.getLocation({type:"wgs84",success:function(e){t.openLocation({latitude:i,longitude:n,name:c,address:r,success:function(){}})}})},productStatusChange:function(t){var e=[null,"ONLINE","OFFLINE","UNACTIVE","DISABLE"],i=t.detail.value;this.currentStatusIndex=i,this.status=e[i],this.currentPage=1,this.deviceList=[],this.mescroll.resetUpScroll()},productTypeChange:function(t){var e=t.detail.value;this.currentTypeIndex=e,this.productId=this.productTypeData[e].productId,this.currentPage=1,this.deviceList=[],this.mescroll.resetUpScroll()}},components:{mapFav:s,surplus:o}};e.default=l}).call(this,i("543d")["default"])},f715:function(t,e,i){"use strict";i.d(e,"b",(function(){return c})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return n}));var n={mescrollUni:function(){return Promise.all([i.e("common/vendor"),i.e("components/mescroll-uni/mescroll-uni")]).then(i.bind(null,"1387"))}},c=function(){var t=this,e=t.$createElement;t._self._c},r=[]}},[["0315","common/runtime","common/vendor"]]]);