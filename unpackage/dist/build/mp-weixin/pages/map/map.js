(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/map/map"],{"0315":function(e,t,i){"use strict";(function(e){i("91b7"),i("921b");n(i("66fd"));var t=n(i("4724"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},"436d":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return n}));var n={mescrollUni:function(){return Promise.all([i.e("common/vendor"),i.e("components/mescroll-uni/mescroll-uni")]).then(i.bind(null,"1387"))}},o=function(){var e=this,t=e.$createElement;e._self._c},a=[]},4724:function(e,t,i){"use strict";i.r(t);var n=i("436d"),o=i("90fe");for(var a in o)"default"!==a&&function(e){i.d(t,e,(function(){return o[e]}))}(a);i("75dc");var r,c=i("f0c5"),s=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"741d4e29",null,!1,n["a"],r);t["default"]=s.exports},"61c1":function(e,t,i){},"75dc":function(e,t,i){"use strict";var n=i("61c1"),o=i.n(n);o.a},"90fe":function(e,t,i){"use strict";i.r(t);var n=i("afe2"),o=i.n(n);for(var a in n)"default"!==a&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=o.a},afe2:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=c(i("b060")),o=r(i("9bc8"));function a(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function r(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=n?Object.getOwnPropertyDescriptor(e,o):null;r&&(r.get||r.set)?Object.defineProperty(i,o,r):i[o]=e[o]}return i.default=e,t&&t.set(e,i),i}function c(e){return e&&e.__esModule?e:{default:e}}var s=function(){i.e("components/ztn-custom/surplus/surplus").then(function(){return resolve(i("617a"))}.bind(null,i)).catch(i.oe)},u=function(){i.e("components/ztn-custom/mapFav/mapFav").then(function(){return resolve(i("f53d"))}.bind(null,i)).catch(i.oe)},d={mixins:[n.default],data:function(){return{downOption:{use:!1,auto:!1},upOption:{empty:{use:!0,fixed:!0,top:"10%"}},CustomBar:this.CustomBar,isLogin:!0,isLoginOverdue:!1,isShowMap:!0,showMode:"",selectStyle:"",unselectStyle:"",enlargeScaleToListMode:!1,enlargeScaleToPointMode:!1,scale:4.5,beforeScale:4.5,longitude:114.32452,latitude:27.099994,markers:[],markerId:Number,currentPage:1,pageSize:10,productId:null,status:null,currentStatusIndex:0,currentTypeIndex:0,productTypeList:[],productTypeData:[],deviceList:[],isShowDeviceList:!1,totalDeviceNum:0,hideIcon:"../../static/images/down.png",modalDeviceName:"",listTouchStart:0,listTouchDirection:null}},name:"mapComponent",computed:{i18n:function(){return this.$i18nMsg()},themei18n:function(){return this.$themei18nOption()}},beforeMount:function(){var e=this.themei18n.emphasizeColor;this.selectStyle="background:".concat(e,";color:#fff;border:2upx solid ").concat(e),this.unselectStyle="background:#fff;color:".concat(e,";border:2upx solid ").concat(e)},mounted:function(){var t=e.getStorageSync("isLogin")||!1;this.isLogin=t,t&&this.init()},methods:{init:function(){var t=e.getStorageSync("showMode")||"listMode";this.showMode=t,this.getProductTypeList(),this.getProvinceDeviceNum()},tapMode:function(t){var i=this,n=this.showMode;n!=t&&(this.isShowMap=!1,this.$nextTick((function(){i.markers=[],i.isShowMap=!0,i.showMode=t,i.enlargeScaleToListMode=!1,i.enlargeScaleToPointMode=!1,i.scale=4.5,i.longitude=114.32452,i.latitude=27.099994,i.markerId=null,i.getProvinceDeviceNum(),e.setStorageSync("showMode",t)})))},getProvinceDeviceNum:function(){var e=this;o.getProvinceDeviceNum(this).then((function(t){if("200"==t.code){var i=t.data;e.setMarkers(i)}}))},getCityDeviceNum:function(){var e=this;o.getCityDeviceNum(this).then((function(t){if("200"==t.code){var i=t.data;e.setMarkers(i)}}))},setMarkers:function(e){this.markers=[];for(var t=[],i=0;i<e.length;i++){var n={};n.id=Number(e[i].cityId?e[i].cityId:e[i].provinceId),n.width=25,n.height=25,n.latitude=Number(e[i].lat),n.longitude=Number(e[i].lng),e[i].num>=99?n.iconPath="../../static/numsImage/local_99.png":n.iconPath="../../static/numsImage/local_"+e[i].num+".png",t.push(n)}this.markers=t},setPointMarkers:function(e){var t=this;this.$uniUtilsApi.showLoading(this.i18n.loading,!0),this.markers=[];for(var i=[],n=0;n<e.length;n++){var o={};o.id=n,o.width=25,o.height=25,o.latitude=Number(e[n].lat),o.longitude=Number(e[n].lng),o.mode="point",o.iconPath="../../static/images/gps.png",o.deviceName=e[n].deviceName,o.deviceCore=e[n].deviceCore,o.pageCur="deviceInfo",i.push(o)}this.markers=i.length>6e3?i.slice(0,6e3):i,setTimeout((function(){t.$uniUtilsApi.hideLoading()}),1e3)},markertap:function(e){var t=e.detail.markerId;this.markerId=t;var i=this.showMode;"listMode"==i?this.markertapListMode():this.markertapPointMode()},markertapListMode:function(){this.isShowDeviceList=!0,this.$emit("isShowNav",!1),this.currentPage=1},markertapPointMode:function(){var e=this.markers,t=e[0].mode;if("point"==t){var i=this.markerId,n=e[i],o=n.deviceName,a=n.deviceCore,r=n.pageCur;this.deviceNavigation(o,a,r)}else this.byMarkerGetDeviceList()},byMarkerPageGetDeviceList:function(){var e=this,t=this.enlargeScaleToListMode,i=t?null:this.markerId,n=t?this.markerId:null,a=this.productId,r=this.status,c=this.currentPage,s=this.pageSize;o.byMarkerPageGetDeviceList(this,i,n,a,r,c,s).then((function(t){if("200"==t.code){var i=t.data,n=i.currentPage,o=i.data,a=i.total;e.totalDeviceNum=a,e.mescroll.endByPage(o.length,a);var r=n-1,c=e.$uniUtilsApi.initDeviceList(e.i18n.status,o);e.$set(e.deviceList,r,c),e.currentPage=n+1}}))},byMarkerGetDeviceList:function(){var e=this,t=this.markerId;o.byMarkerGetDeviceList(this,t).then((function(t){"200"==t.code&&(e.isShowMap=!1,e.$nextTick((function(){e.isShowMap=!0;var i=t.data;e.setPointMarkers(i),e.latitude=i[0].lat,e.longitude=i[0].lng,e.scale=7,setTimeout((function(){e.enlargeScaleToPointMode=!0}),1e3)})))}))},getScale:function(){var t=e.createMapContext("myMap",this),i=new Promise((function(e){t.getScale({success:function(t){e(t)}})}));return i},regionchange:function(){var e=this,t=this.getScale();t.then((function(t){var i=e.showMode;"listMode"==i?e.getDeviceNumToListMode(t):"pointMode"==i&&e.getDeviceNumToPointMode(t)}))},getDeviceNumToListMode:function(e){var t=e.scale,i=this.enlargeScaleToListMode;t<6&&i?(this.getProvinceDeviceNum(),this.enlargeScaleToListMode=!1):t>=6&&!i&&(this.getCityDeviceNum(),this.enlargeScaleToListMode=!0)},getDeviceNumToPointMode:function(e){var t=e.scale,i=this.beforeScale;this.beforeScale=e.scale;var n=this.enlargeScaleToPointMode;t<6&&t<i&&n&&(this.enlargeScaleToPointMode=!1,this.getProvinceDeviceNum())},hideDeviceList:function(){this.isShowDeviceList=!1,this.$emit("isShowNav",!0),this.currentStatusIndex=0,this.currentTypeIndex=0,this.status=null,this.productId=null,this.currentPage=1,this.deviceList=[]},ListTouchStart:function(e){this.listTouchStart=e.touches[0].pageX},ListTouchMove:function(e){this.listTouchDirection=e.touches[0].pageX-this.listTouchStart>0?"right":"left"},ListTouchEnd:function(e){"left"==this.listTouchDirection?this.modalDeviceName=e.currentTarget.dataset.devicename:this.modalDeviceName=null,this.listTouchDirection=null},deviceNavigation:function(t,i,n){e.navigateTo({url:"/pages/deviceNavigation/deviceNavigation?deviceName=".concat(t,"&deviceCore=").concat(i,"&pageCur=").concat(n)})},navigation:function(t){var i=t.deviceLat,n=t.deviceLng,o=t.deviceName,a=t.deviceAddr;e.getLocation({type:"wgs84",success:function(t){e.openLocation({latitude:i,longitude:n,name:o,address:a,success:function(){}})}})},getProductTypeList:function(){var t=this,i=e.getStorageSync("userId");o.getProductTypeList(this,i).then((function(e){if("200"==e.code){var i=e.data,n=t.$uniUtilsApi.handleProductType(t,i),o=n.productTypeList,a=n.productTypeData;t.productTypeList=o,t.productTypeData=a}}))},productStatusChange:function(e){var t=[null,"ONLINE","OFFLINE","UNACTIVE","DISABLE"],i=e.detail.value;this.currentStatusIndex=i,this.status=t[i],this.currentPage=1,this.deviceList=[],this.mescroll.resetUpScroll()},productTypeChange:function(e){var t=e.detail.value;this.currentTypeIndex=t,this.productId=this.productTypeData[t].productId,this.currentPage=1,this.deviceList=[],this.mescroll.resetUpScroll()},goToLogin:function(t){e.navigateTo({url:"/pages/login/login"})}},components:{mapFav:u,surplus:s}};t.default=d}).call(this,i("543d")["default"])}},[["0315","common/runtime","common/vendor"]]]);