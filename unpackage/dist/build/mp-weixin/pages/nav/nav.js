(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/nav/nav"],{"0e7b":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=h(i("5684")),r=h(i("4724")),o=h(i("44f2")),a=h(i("1c5d")),s=d(i("0db3")),c=d(i("870a")),u=(d(i("5891")),h(i("a202")));function l(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function d(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=l();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=n?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=e[r]}return i.default=e,t&&t.set(e,i),i}function h(e){return e&&e.__esModule?e:{default:e}}var f=function(){i.e("components/ztn-custom/tabbar/tabbar").then(function(){return resolve(i("6cbf"))}.bind(null,i)).catch(i.oe)},p={mixins:[u.default],data:function(){return{CustomBar:this.CustomBar,fromLoginBack:!1,refresh:!1,isLogin:!1,pageCur:"",tabbarList:[],tabbarHeight:"",isShow:!0,themeColor:"#70c8e2",currentProductId:null}},computed:{i18n:function(){return this.$i18nMsg()}},onReady:function(){},onLoad:function(){this.getCompanyInfo(),this.initTabbar()},onShow:function(){var t=this,i=this.fromLoginBack,n=this.refresh;if(i||n){var r=e.getStorageSync("language");i&&this.lang(r);var o=this.pageCur;this.pageCur="",this.$nextTick((function(){t.connectSocket(),t.pageCur=o,t.fromLoginBack=!1,t.refresh=!1,t.isLogin=!0}))}},methods:{getCompanyInfo:function(){var e=this,t=this.$uniUtilsApi.getCompanyInfo(this);t.then((function(){e.pageCur="home",e.init()}))},initTabbar:function(){this.tabbarList=[{tabbar:"home",tabbarName:this.i18n.nav.home,tabbarCuIcon:"cuIcon-homefill"},{tabbar:"map",tabbarName:this.i18n.nav.map,tabbarCuIcon:"cuIcon-locationfill"},{tabbar:"list",tabbarName:this.i18n.nav.list,tabbarCuIcon:"cuIcon-circlefill"},{tabbar:"center",tabbarName:this.i18n.nav.center,tabbarCuIcon:"cuIcon-peoplefill"}]},init:function(){var t=e.getStorageSync("openid");t?(this.openid=t,this.useOpenidLogin()):this.WEIXINGetOpenid()},getTabbarHeight:function(e){this.tabbarHeight=e},navChange:function(t){var i=e.getStorageSync("isLogin"),n=this.pageCur;n!==t?(this.pageCur=t,"list"===n&&(this.currentProductId=null)):i&&("home"===t&&this.$refs["".concat(t)].initResource(),"list"===t?this.$refs.mescrollItem.refresh():this.$refs["".concat(t)].init(),this.$uniUtilsApi.showToast(this.i18n.refreshSuccess,"none",1e3,!1))},isShowNav:function(e){this.isShow=e},showMapFav:function(t){e.$emit("MapFavValue",t)},list:function(e){this.currentProductId=e.productId,this.pageCur=e.pageCur},themeChange:function(){this.$refs.tabbar.themeChange()},languageChange:function(){this.initTabbar()},unLogin:function(){this.isLogin=!1},WEIXINGetOpenid:function(){var t=this,i=e.getStorageSync("companyId");e.login({success:function(n){c.WEIXINGetOpenid(t,n.code,i).then((function(i){t.openid=i.data.openid,e.setStorageSync("openid",t.openid),t.useOpenidLogin()}))},fail:function(e){t.$uniUtilsApi.showToast(t.i18n.login.userInfoFail,"none",1e3,!1)}})},H5GetOpenid:function(){var t=window.location.href,i=t.split("?")[1];if(i){var n=new URLSearchParams(i);n&&"singlemessage"==n.get("from")&&(this.openid=n.get("openid"),e.setStorageSync("openid",this.openid),this.useOpenidLogin())}},useOpenidLogin:function(t){var i=this,n=this.openid,r=e.getStorageSync("companyId");t=s.userLogin(this,{companyId:r,openid:n,getType:"wxApp"});t.then((function(t){if(t.status)switch(t.code){case"200":var n=t.data,r=n.userId,o=n.userName,a=n.devKey,s=n.accessToken,c=n.singleLogin,u=n.language,l="zh"==u?0:1;e.setStorageSync("userId",r),e.setStorageSync("userName",o),e.setStorageSync("devKey",a),e.setStorageSync("accessToken",s),e.setStorageSync("singleLogin",c),e.setStorageSync("language",u),e.setStorageSync("languageIndex",l),e.setStorageSync("isLogin",!0),i.isLogin=!0,i.lang(u),i.connectSocket();break;case"201":e.setStorageSync("isLogin",!1),i.isLogin=!1,i.$uniUtilsApi.showToast(i.i18n.login.bindUser,"none",1e3,!1),i.lang(e.getStorageSync("language"));break;default:i.$uniUtilsApi.showToast(i.i18n.login.unknownError,"none",1e3,!1);break}}))},connectSocket:function(){var e=this.i18n.openMessage,t=this.i18n.closeMessage;this.$uniUtilsApi.connectSocket(),this.$uniUtilsApi.openSocket(this,e,t)},lang:function(e){this.$i18n.locale=e,this.languageChange()}},components:{homeComponent:n.default,mapComponent:r.default,listComponent:o.default,centerComponent:a.default,tabbar:f},onShareAppMessage:function(t){var i=this.pageCur,n=e.getStorageSync("nickName"),r=e.getStorageSync("shortCompanyName");return{title:"".concat(n).concat(this.i18n.moreOperate.share).concat(r),path:"/pages/nav/nav?pageCur=".concat(i),success:function(e){}}}};t.default=p}).call(this,i("543d")["default"])},"19d9":function(e,t,i){"use strict";i.r(t);var n=i("e289"),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},"1c5d":function(e,t,i){"use strict";i.r(t);var n=i("41f7"),r=i("c57a");for(var o in r)"default"!==o&&function(e){i.d(t,e,(function(){return r[e]}))}(o);var a,s=i("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);t["default"]=c.exports},"41f7":function(e,t,i){"use strict";var n;i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var r=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.isLogin?e.tapCurrentVersion():e.unLogin()},e.e1=function(t){e.isLogin?e.moreOperate():e.unLogin()},e.e2=function(t){e.isLogin?e.deviceNotice():e.unLogin()},e.e3=function(t){e.isLogin?e.tapScan():e.unLogin()},e.e4=function(t){e.isLogin?e.deviceError():e.unLogin()},e.e5=function(t){e.isLogin?e.deviceStatus():e.unLogin()},e.e6=function(t){e.isLogin?e.more():e.unLogin()},e.e7=function(t){e.isLogin?e.pushMessage():e.unLogin()})},o=[]},"436d":function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var n={mescrollUni:function(){return Promise.all([i.e("common/vendor"),i.e("components/mescroll-uni/mescroll-uni")]).then(i.bind(null,"1387"))}},r=function(){var e=this,t=e.$createElement;e._self._c},o=[]},"44f2":function(e,t,i){"use strict";i.r(t);var n=i("9d0b"),r=i("c75a");for(var o in r)"default"!==o&&function(e){i.d(t,e,(function(){return r[e]}))}(o);var a,s=i("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);t["default"]=c.exports},4724:function(e,t,i){"use strict";i.r(t);var n=i("436d"),r=i("90fe");for(var o in r)"default"!==o&&function(e){i.d(t,e,(function(){return r[e]}))}(o);i("75dc");var a,s=i("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"741d4e29",null,!1,n["a"],a);t["default"]=c.exports},"4d26":function(e,t,i){},5225:function(e,t,i){"use strict";var n=i("6bd7"),r=i.n(n);r.a},"52c0":function(e,t,i){"use strict";i.r(t);var n=i("54be"),r=i("7102");for(var o in r)"default"!==o&&function(e){i.d(t,e,(function(){return r[e]}))}(o);i("9aa3");var a,s=i("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);t["default"]=c.exports},"54be":function(e,t,i){"use strict";var n;i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var r=function(){var e=this,t=e.$createElement;e._self._c},o=[]},5684:function(e,t,i){"use strict";i.r(t);var n=i("7829"),r=i("19d9");for(var o in r)"default"!==o&&function(e){i.d(t,e,(function(){return r[e]}))}(o);i("5225");var a,s=i("f0c5"),c=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"a7952658",null,!1,n["a"],a);t["default"]=c.exports},"61c1":function(e,t,i){},"6bd7":function(e,t,i){},"6cc7":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(i("a34a")),r=c(i("9bc8")),o=c(i("9a3a")),a=u(i("b060"));function s(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=n?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=e[r]}return i.default=e,t&&t.set(e,i),i}function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return p(e)||f(e)||h(e)||d()}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){if(e){if("string"===typeof e)return g(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?g(e,t):void 0}}function f(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function p(e){if(Array.isArray(e))return g(e)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function v(e,t,i,n,r,o,a){try{var s=e[o](a),c=s.value}catch(u){return void i(u)}s.done?t(c):Promise.resolve(c).then(n,r)}function m(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var o=e.apply(t,i);function a(e){v(o,n,r,a,s,"next",e)}function s(e){v(o,n,r,a,s,"throw",e)}a(void 0)}))}}var S=function(){i.e("components/ztn-custom/surplus/surplus").then(function(){return resolve(i("617a"))}.bind(null,i)).catch(i.oe)},y=function(){i.e("components/ztn-custom/listFav/listFav").then(function(){return resolve(i("ca37"))}.bind(null,i)).catch(i.oe)},L={mixins:[a.default],data:function(){return{CustomBar:this.CustomBar,isLogin:!0,isLoginOverdue:!1,customIcon:"cuIcon-sort",downOption:{use:!0,auto:!1},upOption:{use:!0,auto:!1,empty:{use:!0,fixed:!0,top:"25%"}},imageSrc:"/static/images/noContent.png",navScrollHeight:0,isShowNavScroll:!1,isShowList:!1,searchNameInput:"",isShowSearchButton:!1,productTypeList:[],productTypeData:[],productSeriesList:[],productSeriesData:[],productTypeSeriesList:[],productTypeSeriesListCopy:[],productGroupList:[],productGroupData:[],productPageList:[],currentStatusIndex:0,currentTypeSeriesIndex:[0,0],currentTypeSeriesIndexCopy:[0,0],currentAlarmIndex:0,currentGroupIndex:0,currentPageIndex:0,deviceList:[],searchStatus:null,productId:null,seriesId:null,groupId:null,searchName:null,todayOnline:!1,warnDesc:!1,currentPage:1,pageSize:10}},name:"listComponent",computed:{i18n:function(){return this.$i18nMsg()}},props:{currentProductId:{type:[Number,String],default:null},tabbarHeight:{type:[Number,String],default:""}},mounted:function(){var t=e.getStorageSync("isLogin")||!1;this.isLogin=t,t&&this.init()},methods:{refresh:function(){var e=this;this.mescroll.scrollTo(0,300),setTimeout((function(){e.mescroll.triggerDownScroll()}),500)},init:function(){var e=this,t=this.currentProductId;this.productId=t,this.getDeviceList(),this.getProductGroupList(),this.getTypeSeries().then((function(i){var n=e.productTypeList,r=e.productTypeData,o=e.productSeriesList;e.productTypeSeriesList=[n,o],e.productTypeSeriesListCopy=[n,o];var a=r.findIndex((function(e){return e.productId===t}));e.currentTypeSeriesIndex=[a,0],e.currentTypeSeriesIndexCopy=[a,0]}))},downCallback:function(){this.currentPage=1,this.deviceList=[],this.mescroll.resetUpScroll()},getTypeSeries:function(){var e=m(n.default.mark((function e(){var t;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.productId,e.next=3,this.getProductTypeList();case 3:if(!t){e.next=8;break}return e.next=6,this.getProductSeriesList();case 6:e.next=9;break;case 8:this.handleProductSeriesList([]);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getProductTypeList:function(){var t=this,i=e.getStorageSync("userId");return new Promise((function(e,n){r.getProductTypeList(t,i).then((function(i){if("200"==i.code){var n=i.data,r=t.$uniUtilsApi.handleProductType(t,n),o=r.productTypeList,a=r.productTypeData;t.productTypeList=o,t.productTypeData=a,e()}}))}))},getProductSeriesList:function(){var t=this,i=e.getStorageSync("userId"),n=this.productId;return new Promise((function(e,o){r.getProductSeries(t,i,n).then((function(i){if("200"==i.code){var n=i.data;t.handleProductSeriesList(n),e()}}))}))},handleProductSeriesList:function(e){var t=this.$uniUtilsApi.handleProductSeries(this,e),i=t.productSeriesList,n=t.productSeriesData;this.productSeriesList=i,this.productSeriesData=n},getProductGroupList:function(){var t=this,i=e.getStorageSync("userId");o.getProductGroupList(this,i).then((function(e){if("200"==e.code){var i=e.data,n=t.$uniUtilsApi.handleProductGroup(t,i),r=n.productGroupList,o=n.productGroupData;t.productGroupList=r,t.productGroupData=o}}))},getDeviceList:function(){var t=this,i=e.getStorageSync("userId"),n=this.searchStatus,o=this.productId,a=this.seriesId,s=this.searchName,c=this.todayOnline,u=this.warnDesc,l=this.groupId,d=this.currentPage,h=this.pageSize;r.getDeviceList(this,i,n,o,a,s,c,u,l,d,h).then((function(i){if("200"==i.code){var n=i.data,r=n.currentPage,o=n.data,a=n.total;if(!t.isShowNavScroll){t.isShowNavScroll=!0;var s=e.getStorageSync("navScrollHeight");s?(t.navScrollHeight=s,t.isShowList=!0):t.$nextTick((function(){setTimeout((function(){e.createSelectorQuery().in(t).select("#navScroll").boundingClientRect((function(i){var n=i.height;t.navScrollHeight=n,t.isShowList=!0,e.setStorageSync("navScrollHeight",n)})).exec()}),200)}))}for(var c=Math.ceil(a/h),u=[],l=1;l<=c;l++){var d=t.i18n.list.page,f=t.i18n.list.the;u.push("en"==t._i18n.locale?d+l:f+l+d)}t.productPageList=u,t.mescroll.endByPage(o.length,a);var p=t.$uniUtilsApi.initDeviceList(t.i18n.status,o),g=r-1;t.$set(t.deviceList,g,p),t.currentPageIndex=g,t.currentPage=r+1}}))},productStatusChange:function(e){var t=[null,"ONLINE","OFFLINE","UNACTIVE","DISABLE"],i=e.detail.value;this.currentStatusIndex=i,this.searchStatus=t[i],this.currentPage=1,this.deviceList=[],this.mescroll.scrollTo(0,300),this.mescroll.resetUpScroll()},typeSeriesColumnchange:function(e){var t=this,i=e.detail.column,n=e.detail.value;switch(i){case 0:if(0!=n){var r=this.productTypeData;this.productId=r[n].productId;var o=this.getProductSeriesList();o.then((function(e){var i=t.productSeriesList;t.productSeriesData;t.$set(t.productTypeSeriesListCopy,1,i),t.currentTypeSeriesIndexCopy=[n,0]}))}else this.$set(this.productTypeSeriesListCopy,1,this.i18n.list.productSeriesList),this.currentTypeSeriesIndexCopy=[0,0];break;default:break}this.$forceUpdate()},typeSeriesChange:function(e){var t=e.detail.value,i=this.productTypeData,n=this.productSeriesData;this.currentTypeSeriesIndex=t,this.currentTypeSeriesIndexCopy=t,this.productId=i[t[0]].productId,this.seriesId=n[t[1]].seriesId,this.productTypeSeriesList=l(this.productTypeSeriesListCopy),this.currentPage=1,this.deviceList=[],this.mescroll.scrollTo(0,300),this.mescroll.resetUpScroll()},productAlarmChange:function(e){var t,i,n=e.detail.value;this.currentAlarmIndex=n,0==n?(t=!1,i=!1):1==n?(t=!0,i=!1):2==n?(t=!1,i=!0):3==n&&(t=!0,i=!0),this.todayOnline=t,this.warnDesc=i,this.currentPage=1,this.deviceList=[],this.mescroll.scrollTo(0,300),this.mescroll.resetUpScroll()},productGroupChange:function(e){var t=e.detail.value;this.currentGroupIndex=t,this.groupId=this.productGroupData[t].groupId,this.currentPage=1,this.deviceList=[],this.mescroll.scrollTo(0,300),this.mescroll.resetUpScroll()},productPageChange:function(e){var t=e.detail.value;this.currentPageIndex=t,this.currentPage=parseInt(t)+1,this.deviceList=[],this.mescroll.scrollTo(0,300),this.mescroll.resetUpScroll()},searchNameInputChange:function(e){var t=e.detail.value.replace(/\s/g,"");""==t?this.deleteSearchName():(this.searchNameInput=t,this.isShowSearchButton=!0)},deleteSearchName:function(e){this.searchNameInput="",this.searchName=null,this.isShowSearchButton=!1,this.currentPage=1,this.deviceList=[],this.mescroll.scrollTo(0,300),this.mescroll.resetUpScroll()},tapSearchName:function(e){this.searchName=this.searchNameInput,this.isShowSearchButton=!1,this.currentPage=1,this.deviceList=[],this.mescroll.scrollTo(0,300),this.mescroll.resetUpScroll()},deviceNavigation:function(t,i,n){e.navigateTo({url:"/pages/deviceNavigation/deviceNavigation?deviceName=".concat(t,"&deviceCore=").concat(i,"&pageCur=").concat(n)})},areaList:function(t){e.navigateTo({url:"/pages/areaList/areaList"})},goToLogin:function(t){e.navigateTo({url:"/pages/login/login"})}},components:{listFav:y,surplus:S}};t.default=L}).call(this,i("543d")["default"])},7102:function(e,t,i){"use strict";i.r(t);var n=i("0e7b"),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},"75dc":function(e,t,i){"use strict";var n=i("61c1"),r=i.n(n);r.a},7829:function(e,t,i){"use strict";var n;i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var r=function(){var e=this,t=e.$createElement;e._self._c},o=[]},"90fe":function(e,t,i){"use strict";i.r(t);var n=i("afe2"),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},"9aa3":function(e,t,i){"use strict";var n=i("4d26"),r=i.n(n);r.a},"9d0b":function(e,t,i){"use strict";var n;i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var r=function(){var e=this,t=e.$createElement;e._self._c},o=[]},aa2d:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=c(i("a34a")),r=s(i("870a")),o=(s(i("1b64")),s(i("9bc8")));s(i("0db3")),c(i("8cdf"));function a(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function s(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=n?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=e[r]}return i.default=e,t&&t.set(e,i),i}function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t,i,n,r,o,a){try{var s=e[o](a),c=s.value}catch(u){return void i(u)}s.done?t(c):Promise.resolve(c).then(n,r)}function l(e){return function(){var t=this,i=arguments;return new Promise((function(n,r){var o=e.apply(t,i);function a(e){u(o,n,r,a,s,"next",e)}function s(e){u(o,n,r,a,s,"throw",e)}a(void 0)}))}}var d={data:function(){return{isLogin:!1,isLoginOverdue:!1,userName:"",avatarUrl:"",deviceStatusList:[{},{},{},{}],deviceStatusNumberList:[0,0,0,0],currentMessageIndex:0,currentLanguageIndex:0,currentThemeIndex:0,openMessage:!1}},name:"centerComponent",computed:{i18n:function(){return this.$i18nMsg()},themei18n:function(){return this.$themei18nOption()}},mounted:function(){var t=e.getStorageSync("isLogin");this.isLogin=t,t?this.init():this.getUnLoginDeviceStatusCount()},methods:{init:function(){var t=l(n.default.mark((function t(){return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.getDeviceStatusCount(),this.userName=e.getStorageSync("userName"),this.avatarUrl=e.getStorageSync("avatarUrl"),this.openMessage=e.getStorageSync("openMessage")||!1,this.currentMessageIndex=e.getStorageSync("messageIndex")||0,this.currentThemeIndex=e.getStorageSync("themeIndex")||0,this.currentLanguageIndex=e.getStorageSync("languageIndex")||0;case 7:case"end":return t.stop()}}),t,this)})));function i(){return t.apply(this,arguments)}return i}(),goToLogin:function(t){e.navigateTo({url:"/pages/login/login"})},getUnLoginDeviceStatusCount:function(){for(var e=this.deviceStatusList,t=0;t<e.length;t++)this.$set(this.deviceStatusList,t,{num:"--",status:this.i18n.status[t]})},getDeviceStatusCount:function(){var e=this;o.getDeviceStatusCount(this).then((function(t){if("200"==t.code){for(var i=t.data,n=0;n<i.length;n++){var r=i[n].num;switch(i[n].status){case"ONLINE":e.$set(e.deviceStatusNumberList,0,r);break;case"OFFLINE":e.$set(e.deviceStatusNumberList,1,r);break;case"UNACTIVE":e.$set(e.deviceStatusNumberList,2,r);break;case"DISABLE":e.$set(e.deviceStatusNumberList,3,r);break;default:break}}var o=0,a=e.deviceStatusList,s=(e.deviceStatusNumberList,function t(){if(o<20)setTimeout((function(){for(var i=0;i<a.length;i++)e.$set(e.deviceStatusList,i,{num:0===e.deviceStatusNumberList[i]?0:o,status:e.i18n.status[i]});o++,t()}),10);else for(var i=0;i<a.length;i++)e.$set(e.deviceStatusList,i,{num:e.deviceStatusNumberList[i],status:e.i18n.status[i]})});s()}}))},tapCurrentVersion:function(){var e=this.i18n.currentVersion,t=wx.getStorageSync("browserVersion")||"1.1.24",i=this.i18n.confirm,n=this.i18n.cancel;this.$uniUtilsApi.showModal(e,t,!1,i,n,(function(e){}))},moreOperate:function(){e.navigateTo({url:"/pages/moreOperate/moreOperate"})},deviceNotice:function(){e.navigateTo({url:"/pages/deviceNotice/deviceNotice"})},tapScan:function(){this.$uniUtilsApi.handleScan(this)},deviceError:function(){e.navigateTo({url:"/pages/deviceError/deviceError"})},deviceStatus:function(){e.navigateTo({url:"/pages/deviceStatus/deviceStatus"})},moreSetting:function(){e.navigateTo({url:"/pages/moreSetting/moreSetting"})},pushMessage:function(){var t=!this.openMessage;if(t){var i=this.i18n.openMessage;this.$uniUtilsApi.bindUserSocket(i)}else{var n=this.i18n.closeMessage;this.$uniUtilsApi.unBindUserSocket(n)}this.openMessage=t,this.currentMessageIndex=t?1:0,e.setStorageSync("openMessage",t),e.setStorageSync("messageIndex",this.currentMessageIndex)},languagePickerChange:function(t){var i=this,n=this.isLogin,o=parseInt(t.detail.value),a=0==o?"zh":"en";if(n){var s=wx.getStorageSync("userId");r.updateLanguage(this,a,s).then((function(t){"200"==t.code&&(i.currentLanguageIndex=o,i.$i18n.locale=a,i.$emit("languageChange"),e.setStorageSync("language",a),e.setStorageSync("languageIndex",o),i.$uniUtilsApi.showToast(i.i18n.changeLanguage,"none",1e3,!1))}))}else this.$i18n.locale=a,this.$emit("languageChange"),this.$uniUtilsApi.showToast(this.i18n.changeLanguage,"none",1e3,!1)},themePickerChange:function(t){var i=this.isLogin;if(i){var n=t.detail.value,r=["default","darkColor","lightColor"],o=r[n];this.currentThemeIndex=n,this.$themei18n.locale=o,e.setStorageSync("theme",o),e.setStorageSync("themeIndex",n),this.$emit("themeChange"),this.$uniUtilsApi.showToast(this.i18n.changeTheme,"none",1e3,!1)}else this.unLogin()},tapLogout:function(){var t=this,i=this.i18n.moreSetting.logout,n=this.i18n.moreSetting.logoutContent,o=this.i18n.confirm,a=this.i18n.cancel;this.$uniUtilsApi.showModal(i,n,!0,o,a,(function(i){var n,o=e.getStorageSync("openid");n=r.loginOut(t,{openid:o,type:"wxAPP"}),n.then((function(i){if(i.status){var n=e.getStorageSync("openMessage")||!1,r=t.i18n.closeMessage;n&&t.$uniUtilsApi.unBindUserSocket(r),e.removeStorageSync("openid"),e.removeStorageSync("nickName"),e.removeStorageSync("avatarUrl"),e.removeStorageSync("userId"),e.removeStorageSync("userName"),e.removeStorageSync("devKey"),e.removeStorageSync("accessToken"),e.removeStorageSync("singleLogin"),e.setStorageSync("isLogin",!1),t.isLogin=!1,n&&t.$uniUtilsApi.closeSocket(),t.$uniUtilsApi.showToast(t.i18n.logoutSuccess,"success",1e3,!1),t.$emit("unLogin"),t.getUnLoginDeviceStatusCount()}}))}),(function(e){}))},unLogin:function(){this.$uniUtilsApi.showToast(this.i18n.leadGotoLogin.unLogStatuTxt,"none",1e3,!1)},more:function(){this.$uniUtilsApi.showToast(this.i18n.noSupport,"none",1e3,!1)}}};t.default=d}).call(this,i("543d")["default"])},afe2:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(i("b060")),r=a(i("9bc8"));function o(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function a(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var a=n?Object.getOwnPropertyDescriptor(e,r):null;a&&(a.get||a.set)?Object.defineProperty(i,r,a):i[r]=e[r]}return i.default=e,t&&t.set(e,i),i}function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){i.e("components/ztn-custom/surplus/surplus").then(function(){return resolve(i("617a"))}.bind(null,i)).catch(i.oe)},u=function(){i.e("components/ztn-custom/mapFav/mapFav").then(function(){return resolve(i("f53d"))}.bind(null,i)).catch(i.oe)},l={mixins:[n.default],data:function(){return{downOption:{use:!1,auto:!1},upOption:{empty:{use:!0,fixed:!0,top:"10%"}},CustomBar:this.CustomBar,isLogin:!0,isLoginOverdue:!1,isShowMap:!0,showMode:"",selectStyle:"",unselectStyle:"",enlargeScaleToListMode:!1,enlargeScaleToPointMode:!1,scale:4.5,beforeScale:4.5,longitude:114.32452,latitude:27.099994,markers:[],markerId:Number,currentPage:1,pageSize:10,productId:null,status:null,currentStatusIndex:0,currentTypeIndex:0,productTypeList:[],productTypeData:[],deviceList:[],isShowDeviceList:!1,totalDeviceNum:0,hideIcon:"../../static/images/down.png",modalDeviceName:"",listTouchStart:0,listTouchDirection:null}},name:"mapComponent",computed:{i18n:function(){return this.$i18nMsg()},themei18n:function(){return this.$themei18nOption()}},beforeMount:function(){var e=this.themei18n.emphasizeColor;this.selectStyle="background:".concat(e,";color:#fff;border:2upx solid ").concat(e),this.unselectStyle="background:#fff;color:".concat(e,";border:2upx solid ").concat(e)},mounted:function(){var t=e.getStorageSync("isLogin")||!1;this.isLogin=t,t&&this.init()},methods:{init:function(){var t=e.getStorageSync("showMode")||"listMode";this.showMode=t,this.getProductTypeList(),this.getProvinceDeviceNum()},tapMode:function(t){var i=this,n=this.showMode;n!=t&&(this.isShowMap=!1,this.$nextTick((function(){i.markers=[],i.isShowMap=!0,i.showMode=t,i.enlargeScaleToListMode=!1,i.enlargeScaleToPointMode=!1,i.scale=4.5,i.longitude=114.32452,i.latitude=27.099994,i.markerId=null,i.getProvinceDeviceNum(),e.setStorageSync("showMode",t)})))},getProvinceDeviceNum:function(){var e=this;r.getProvinceDeviceNum(this).then((function(t){if("200"==t.code){var i=t.data;e.setMarkers(i)}}))},getCityDeviceNum:function(){var e=this;r.getCityDeviceNum(this).then((function(t){if("200"==t.code){var i=t.data;e.setMarkers(i)}}))},setMarkers:function(e){this.markers=[];for(var t=[],i=0;i<e.length;i++){var n={};n.id=Number(e[i].cityId?e[i].cityId:e[i].provinceId),n.width=25,n.height=25,n.latitude=Number(e[i].lat),n.longitude=Number(e[i].lng),e[i].num>=99?n.iconPath="../../static/numsImage/local_99.png":n.iconPath="../../static/numsImage/local_"+e[i].num+".png",t.push(n)}this.markers=t},setPointMarkers:function(e){var t=this;this.$uniUtilsApi.showLoading(this.i18n.loading,!0),this.markers=[];for(var i=[],n=0;n<e.length;n++){var r={};r.id=n,r.width=25,r.height=25,r.latitude=Number(e[n].lat),r.longitude=Number(e[n].lng),r.mode="point",r.iconPath="../../static/images/gps.png",r.deviceName=e[n].deviceName,r.deviceCore=e[n].deviceCore,r.pageCur="deviceInfo",i.push(r)}this.markers=i.length>6e3?i.slice(0,6e3):i,setTimeout((function(){t.$uniUtilsApi.hideLoading()}),1e3)},markertap:function(e){var t=e.detail.markerId;this.markerId=t;var i=this.showMode;"listMode"==i?this.markertapListMode():this.markertapPointMode()},markertapListMode:function(){this.isShowDeviceList=!0,this.$emit("isShowNav",!1),this.currentPage=1},markertapPointMode:function(){var e=this.markers,t=e[0].mode;if("point"==t){var i=this.markerId,n=e[i],r=n.deviceName,o=n.deviceCore,a=n.pageCur;this.deviceNavigation(r,o,a)}else this.byMarkerGetDeviceList()},byMarkerPageGetDeviceList:function(){var e=this,t=this.enlargeScaleToListMode,i=t?null:this.markerId,n=t?this.markerId:null,o=this.productId,a=this.status,s=this.currentPage,c=this.pageSize;r.byMarkerPageGetDeviceList(this,i,n,o,a,s,c).then((function(t){if("200"==t.code){var i=t.data,n=i.currentPage,r=i.data,o=i.total;e.totalDeviceNum=o,e.mescroll.endByPage(r.length,o);var a=n-1,s=e.$uniUtilsApi.initDeviceList(e.i18n.status,r);e.$set(e.deviceList,a,s),e.currentPage=n+1}}))},byMarkerGetDeviceList:function(){var e=this,t=this.markerId;r.byMarkerGetDeviceList(this,t).then((function(t){"200"==t.code&&(e.isShowMap=!1,e.$nextTick((function(){e.isShowMap=!0;var i=t.data;e.setPointMarkers(i),e.latitude=i[0].lat,e.longitude=i[0].lng,e.scale=7,setTimeout((function(){e.enlargeScaleToPointMode=!0}),1e3)})))}))},getScale:function(){var t=e.createMapContext("myMap",this),i=new Promise((function(e){t.getScale({success:function(t){e(t)}})}));return i},regionchange:function(){var e=this,t=this.getScale();t.then((function(t){var i=e.showMode;"listMode"==i?e.getDeviceNumToListMode(t):"pointMode"==i&&e.getDeviceNumToPointMode(t)}))},getDeviceNumToListMode:function(e){var t=e.scale,i=this.enlargeScaleToListMode;t<6&&i?(this.getProvinceDeviceNum(),this.enlargeScaleToListMode=!1):t>=6&&!i&&(this.getCityDeviceNum(),this.enlargeScaleToListMode=!0)},getDeviceNumToPointMode:function(e){var t=e.scale,i=this.beforeScale;this.beforeScale=e.scale;var n=this.enlargeScaleToPointMode;t<6&&t<i&&n&&(this.enlargeScaleToPointMode=!1,this.getProvinceDeviceNum())},hideDeviceList:function(){this.isShowDeviceList=!1,this.$emit("isShowNav",!0),this.currentStatusIndex=0,this.currentTypeIndex=0,this.status=null,this.productId=null,this.currentPage=1,this.deviceList=[]},ListTouchStart:function(e){this.listTouchStart=e.touches[0].pageX},ListTouchMove:function(e){this.listTouchDirection=e.touches[0].pageX-this.listTouchStart>0?"right":"left"},ListTouchEnd:function(e){"left"==this.listTouchDirection?this.modalDeviceName=e.currentTarget.dataset.devicename:this.modalDeviceName=null,this.listTouchDirection=null},deviceNavigation:function(t,i,n){e.navigateTo({url:"/pages/deviceNavigation/deviceNavigation?deviceName=".concat(t,"&deviceCore=").concat(i,"&pageCur=").concat(n)})},navigation:function(t){var i=t.deviceLat,n=t.deviceLng,r=t.deviceName,o=t.deviceAddr;e.getLocation({type:"wgs84",success:function(t){e.openLocation({latitude:i,longitude:n,name:r,address:o,success:function(){}})}})},getProductTypeList:function(){var t=this,i=e.getStorageSync("userId");r.getProductTypeList(this,i).then((function(e){if("200"==e.code){var i=e.data,n=t.$uniUtilsApi.handleProductType(t,i),r=n.productTypeList,o=n.productTypeData;t.productTypeList=r,t.productTypeData=o}}))},productStatusChange:function(e){var t=[null,"ONLINE","OFFLINE","UNACTIVE","DISABLE"],i=e.detail.value;this.currentStatusIndex=i,this.status=t[i],this.currentPage=1,this.deviceList=[],this.mescroll.resetUpScroll()},productTypeChange:function(e){var t=e.detail.value;this.currentTypeIndex=t,this.productId=this.productTypeData[t].productId,this.currentPage=1,this.deviceList=[],this.mescroll.resetUpScroll()},goToLogin:function(t){e.navigateTo({url:"/pages/login/login"})}},components:{mapFav:u,surplus:c}};t.default=l}).call(this,i("543d")["default"])},c57a:function(e,t,i){"use strict";i.r(t);var n=i("aa2d"),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},c676:function(e,t,i){"use strict";(function(e){i("91b7"),i("921b");n(i("66fd"));var t=n(i("52c0"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},c75a:function(e,t,i){"use strict";i.r(t);var n=i("6cc7"),r=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=r.a},e289:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=c(i("9bc8")),r=c(i("0b74")),o=c(i("1b64")),a=c(i("5891"));function s(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=n?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(i,r,o):i[r]=e[r]}return i.default=e,t&&t.set(e,i),i}var u={data:function(){return{CustomBar:this.CustomBar,customIcon:"cuIcon-add",customColor:"",isShowBindDeviceModal:!1,isLoginOverdue:!1,show:"cardSwiper",indicatorDots:!0,circular:!0,autoplay:!0,interval:5e3,duration:500,indicatorActiveColor:"#70c8e2",cardSwiperList:[],videoHeight:"",videoList:[],playUrl:"",productTypeList:[],currentPage:1,pageSize:10,cameraList:[],playIcon:"../../static/images/cam/play.png",pauseIcon:"../../static/images/cam/pause.png",deviceId:"",pushTime:60}},name:"homeComponent",props:{isLogin:{type:Boolean},tabbarHeight:{type:[Number,String],default:""}},watch:{isLogin:{immediate:!0,handler:function(e,t){e&&this.initResource()},deep:!0}},computed:{themei18n:function(){return this.$themei18nOption()},i18n:function(){return this.$i18nMsg()}},mounted:function(){this.init()},methods:{init:function(){var t=e.getStorageSync("companyId");this.getCardSwiperList(t),this.getVideoList(t),this.getCardSwiperHeight()},initResource:function(){this.getCameraList(),this.getProductTypeList()},getCardSwiperList:function(e){var t=this;a.getCompanyResource(this,"phoneSlideshow",e).then((function(e){if("200"==e.code){for(var i=e.data,n=[],r=0;r<i.length;r++){var o={},a=i[r],s=a.type,c=a.url;o.id=r,o.type=s,o.url=c,n.push(o)}t.cardSwiperList=n}}))},getCardSwiperHeight:function(){var t=this,i=e.getStorageSync("videoHeight");i?this.videoHeight=i:e.createSelectorQuery().in(this).select("#cardSwiper").boundingClientRect((function(i){t.videoHeight=i.height,e.setStorageSync("videoHeight",i.height)})).exec()},cardSwiperChange:function(e){this.cardCur=e.detail.current},getVideoList:function(e){var t=this;a.getCompanyResource(this,"video",e).then((function(e){if("200"==e.code){for(var i=e.data,n=[],r=0;r<i.length;r++){var o={},a=i[r],s=a.iconUrl,c=a.url,u=a.title;o.iconUrl=s,o.url=c,o.title=u,n.push(o)}t.videoList=n}}))},tapVideo:function(e){this.show="agricultureVideo",this.playUrl=e.url},closeVideo:function(e){this.show="cardSwiper",this.playUrl="",this.stopCloud(),this.deviceId=""},getCameraList:function(){var t=this,i=e.getStorageSync("userId"),n=this.currentPage,o=this.pageSize,a=[];r.getCameraDeviceList(this,i,n,o).then((function(e){if("200"==e.code){var i=e.data,r=i.data,o=i.total;if(o<1)return void(t.cameraList=[]);for(var s=0;s<r.length;s++){var c={},u=r[s],l=u.picturePath,d=u.deviceId,h=u.hid;c.picturePath=l&&"".concat(l),c.deviceId=d,c.hid=h,a.push(c)}1==n&&a.length>3?t.cameraList=a.slice(1,5):t.cameraList=a,t.currentPage=n+1}}))},tapCamera:function(t){var i=this;this.show="cameraVideo",this.playUrl="",this.stopCloud();var n=t.deviceId;this.deviceId=n;var o=this.pushTime;r.pushCloud(this,n,o).then((function(t){if("200"==t.code){var n=t.data.playUrl;if(null!=n){var r=t.data.mediaType;i.playUrl=n,i.videoType="m3u8"==r||"httpflv"==r?r:"rtmp"}else i.$uniUtilsApi.showToast(i.i18n.invalidAddress,"none",1e3,!1)}else{if("201"==t.code)switch(t.msg){case"serverCompany":i.$uniUtilsApi.showToast(i.i18n.camera.equipmentNotSupported,"none",1e3,!1);break;case"OFFLINE":i.$uniUtilsApi.showToast(i.i18n.camera.equipmentOffline,"none",1e3,!1);break;default:i.$uniUtilsApi.showToast(i.i18n.camera.pushFailure,"none",1e3,!1);break}else i.$uniUtilsApi.showToast(i.i18n.camera.pushFailure,"none",1e3,!1);setTimeout((function(){e.navigateBack()}),1e3)}}))},stopCloud:function(){var e=this.deviceId;e&&r.stopCloud(this,e).then((function(e){e.code}))},deviceCamera:function(){e.navigateTo({url:"/pages/deviceCamera/deviceCamera"})},getProductTypeList:function(){var t=this,i=e.getStorageSync("userId");n.getProductTypeList(this,i).then((function(e){if("200"==e.code){var i=e.data,n=t.themei18n.standardColor,r=[];for(var o in n){if("grey"==o)break;r.push(n[o])}for(var a=0,s=r.length,c=0;c<i.length;c++)a<s?(i[c].color=r[a],a+=1):(i[c].color=r[0],a=1);t.productTypeList=i}}))},list:function(e){var t={pageCur:"list",productId:e.productId};this.$emit("list",t)},bindDeviceModal:function(){this.isShowBindDeviceModal=!this.isShowBindDeviceModal},bindDevice:function(e){var t=this,i=e.detail.value.deviceCore.replace(/\s/g,"");this.isShowBindDeviceModal=!1,o.getDeviceInfo(this,i).then((function(e){"200"==e.code?t.$uniUtilsApi.showToast(t.i18n.bindSuccess,"none",1e3,!1):t.$uniUtilsApi.showToast(t.i18n.bindFail,"none",1e3,!1)}))}}};t.default=u}).call(this,i("543d")["default"])}},[["c676","common/runtime","common/vendor"]]]);